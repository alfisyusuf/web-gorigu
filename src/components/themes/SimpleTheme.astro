---
import { urlFor } from "../../utils/image";

const { data } = Astro.props;

// Logic Data
const isPriaFirst = data.nameOrder !== 'wanitaFirst';
const namaPertama = isPriaFirst ? data.priaNickname : data.wanitaNickname;
const namaKedua = isPriaFirst ? data.wanitaNickname : data.priaNickname;
const tanggalAkad = new Date(data.akadDate).toLocaleDateString('id-ID', { 
  weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' 
});

// Ambil URL Gambar
const coverUrl = data.coverImage 
  ? urlFor(data.coverImage).width(1200).height(1600).quality(90).url() 
  : 'https://placehold.co/800x1200/4a1e3d/fff?text=Wedding+Invitation';

// --- LOGIKA BARU DIMULAI DI SINI ---
const priaFoto = data.priaFoto 
  ? urlFor(data.priaFoto).width(400).height(500).quality(90).url()
  : 'https://placehold.co/400x500/4a1e3d/fff?text=Groom';
  
const wanitaFoto = data.wanitaFoto 
  ? urlFor(data.wanitaFoto).width(400).height(500).quality(90).url()
  : 'https://placehold.co/400x500/4a1e3d/fff?text=Bride';

// Bungkus data menjadi Object agar mudah ditukar
const groomData = {
    name: data.priaName,
    nickname: data.priaNickname,
    parents: data.priaParents,
    ig: data.priaIg,
    foto: priaFoto,
    label: 'Putra dari' // Label statis
};

const brideData = {
    name: data.wanitaName,
    nickname: data.wanitaNickname,
    parents: data.wanitaParents,
    ig: data.wanitaIg,
    foto: wanitaFoto,
    label: 'Putri dari' // Label statis
};

// Tentukan siapa yang render duluan (kiri/atas)
const first = isPriaFirst ? groomData : brideData;
const second = isPriaFirst ? brideData : groomData;

const backgroundStyle = `background: linear-gradient(rgba(74, 30, 61, 0.85), rgba(74, 30, 61, 0.7)), url('${coverUrl}');`;
---

<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4a1e3d">
    <title>Undangan Pernikahan {namaPertama} & {namaKedua}</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;700&family=Poppins:wght@300;400;500;600&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #4a1e3d;
            --secondary: #e8b4b8;
            --accent: #f5e8e0;
            --text: #333333;
            --light: #ffffff;
            --gold: #d4af37;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: var(--text);
            background-color: var(--light);
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }
        
        /* Cover Section */
        .cover-screen {
            min-height: 100vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            padding: 20px;
            position: relative;
        }
        
        .cover-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.4));
        }
        
        .cover-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            padding: 20px;
        }
        
        .cover-subtitle {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--gold);
            letter-spacing: 2px;
        }
        
        .cover-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin: 20px 0;
            line-height: 1.2;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.3);
        }
        
        .cover-date {
            font-size: 1.1rem;
            margin: 15px 0 30px;
            opacity: 0.9;
        }
        
        .countdown-box {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .cd-item {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            min-width: 70px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .cd-num {
            font-size: 1.8rem;
            font-weight: bold;
            display: block;
            color: var(--gold);
        }
        
        .cd-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
        }
        
        .guest-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 20px 0 30px;
            max-width: 500px;
            width: 100%;
        }
        
        .guest-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
            display: block;
        }
        
        .guest-name {
            font-size: 1.2rem;
            font-weight: 500;
            margin: 0;
        }
        
        .btn-open {
            background: linear-gradient(135deg, var(--gold), #ffd700);
            color: var(--primary);
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .btn-open:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .btn-open:active {
            transform: translateY(0);
        }
        
        /* Main Content */
        .main-content {
            display: none;
        }
        
        /* Section Common */
        .section {
            padding: 70px 20px;
            position: relative;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            color: var(--primary);
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: var(--gold);
            border-radius: 2px;
        }
        
        /* Quote Section */
        .quote-section {
            background: linear-gradient(135deg, var(--accent) 0%, #f9f3f0 100%);
            position: relative;
            overflow: hidden;
        }
        
        .quote-section::before {
            content: '"';
            position: absolute;
            top: 20px;
            left: 20px;
            font-family: 'Playfair Display', serif;
            font-size: 8rem;
            color: rgba(74, 30, 61, 0.1);
            line-height: 1;
        }
        
        .quote-text {
            font-size: 1.2rem;
            font-style: italic;
            color: var(--primary);
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
            line-height: 1.8;
        }
        
        /* Couple Section */
        .couple-wrapper {
            display: flex;
            flex-direction: column;
            gap: 60px;
            margin-top: 40px;
            align-items: center;
        }
        
        @media (min-width: 768px) {
            .couple-wrapper {
                flex-direction: row;
                justify-content: center;
                align-items: flex-start;
                gap: 80px;
            }
        }
        
        .mempelai-card {
            text-align: center;
            max-width: 350px;
        }
        
        .photo-frame {
            width: 220px;
            height: 220px;
            margin: 0 auto 25px;
            border-radius: 50%;
            padding: 8px;
            background: linear-gradient(135deg, var(--gold), #ffd700);
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .mempelai-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid white;
        }
        
        .mempelai-name {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary);
            margin: 10px 0 5px;
        }
        
        .mempelai-nickname {
            font-size: 1.1rem;
            color: var(--gold);
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .ortu-name {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .ig-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--primary);
            background: var(--accent);
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .ig-link:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .divider {
            font-size: 3rem;
            color: var(--gold);
            font-family: 'Dancing Script', cursive;
            font-weight: bold;
        }
        
        /* Event Section */
        .event-section {
            background: linear-gradient(135deg, #fff9f5 0%, #fff0e6 100%);
        }
        
        .event-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        @media (min-width: 768px) {
            .event-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .event-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .event-card:hover {
            transform: translateY(-5px);
        }
        
        .event-icon {
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 20px;
        }
        
        .event-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem;
            color: var(--primary);
            margin-bottom: 15px;
            position: relative;
            padding-bottom: 15px;
        }
        
        .event-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 2px;
            background: var(--secondary);
        }
        
        .event-date {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .event-time {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .event-place {
            font-weight: 600;
            color: var(--primary);
            margin: 15px 0 10px;
            font-size: 1.1rem;
        }
        
        .event-address {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .btn-maps {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }
        
        .btn-maps:hover {
            background: #3a172f;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 30, 61, 0.3);
        }
        
        /* Gallery Section */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 30px;
        }
        
        @media (min-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
        }
        
        .gallery-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 1/1;
            cursor: pointer;
        }
        
        .gallery-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .gallery-item:hover .gallery-img {
            transform: scale(1.05);
        }
        
        .video-container {
            margin-top: 40px;
            text-align: center;
        }
        
        .btn-video {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #ff0000;
            color: white;
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-video:hover {
            background: #cc0000;
            transform: translateY(-2px);
        }
        
        /* Gift Section */
        .gift-section {
            background: linear-gradient(135deg, var(--accent) 0%, #f9f3f0 100%);
        }
        
        .bank-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }
        
        @media (min-width: 768px) {
            .bank-cards {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
        }
        
        .bank-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
            text-align: center;
            max-width: 400px;
            width: 100%;
            border: 1px solid rgba(0,0,0,0.08);
        }
        
        .bank-icon {
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 15px;
        }
        
        .bank-name {
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .account-name {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 15px;
        }
        
        .rek-number {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary);
            margin: 15px 0;
            letter-spacing: 1px;
            font-family: monospace;
            background: #f8f8f8;
            padding: 10px;
            border-radius: 8px;
            border: 1px dashed #ddd;
        }
        
        .btn-copy {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px auto 0;
            transition: all 0.3s ease;
        }
        
        .btn-copy:hover {
            background: #3a172f;
        }
        
        .gift-address {
            margin-top: 40px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
        }
        
        .gift-address-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        /* Footer */
        .footer {
            background: var(--primary);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        
        .footer-text {
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .footer-credits {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        /* Music Control */
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .music-control:hover {
            transform: scale(1.1);
        }
        
        .music-control i {
            font-size: 1.3rem;
        }
        
        /* Scroll Indicator */
        .scroll-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 0.9rem;
            opacity: 0.8;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);}
            40% {transform: translateX(-50%) translateY(-10px);}
            60% {transform: translateX(-50%) translateY(-5px);}
        }
        
        /* Love Story */
        .love-story-timeline {
            max-width: 800px;
            margin: 40px auto 0;
            position: relative;
        }
        
        .love-story-timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--secondary);
            transform: translateX(-50%);
        }
        
        @media (max-width: 767px) {
            .love-story-timeline::before {
                left: 30px;
            }
        }
        
        .story-item {
            display: flex;
            margin-bottom: 40px;
            position: relative;
        }
        
        @media (max-width: 767px) {
            .story-item {
                flex-direction: column;
            }
        }
        
        .story-year {
            background: var(--primary);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            position: absolute;
            top: 0;
            z-index: 2;
        }
        
        @media (min-width: 768px) {
            .story-year {
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                top: -15px;
            }
            
            .story-item:nth-child(odd) .story-content {
                margin-left: auto;
                padding-left: 60px;
                padding-right: 0;
                text-align: right;
            }
            
            .story-item:nth-child(even) .story-content {
                margin-right: auto;
                padding-right: 60px;
                padding-left: 0;
                text-align: left;
            }
        }
        
        @media (max-width: 767px) {
            .story-year {
                left: 0;
                transform: none;
                margin-bottom: 15px;
            }
        }
        
        .story-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            width: calc(50% - 40px);
            position: relative;
        }
        
        @media (max-width: 767px) {
            .story-content {
                width: 100%;
                margin-left: 60px;
                text-align: left;
            }
        }
        
        .story-text {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .story-image {
            width: 100%;
            border-radius: 10px;
            margin-top: 15px;
            height: 200px;
            object-fit: cover;
        }
        
        /* Responsive */
        @media (max-width: 767px) {
            .cover-title {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .section {
                padding: 50px 20px;
            }
            
            .cd-item {
                min-width: 60px;
                padding: 12px;
            }
            
            .cd-num {
                font-size: 1.5rem;
            }
            
            .mempelai-name {
                font-size: 1.5rem;
            }
            
            .photo-frame {
                width: 180px;
                height: 180px;
            }
        }
        
        @media (max-width: 480px) {
            .cover-title {
                font-size: 1.8rem;
            }
            
            .cover-subtitle {
                font-size: 1.2rem;
            }
            
            .btn-open {
                padding: 12px 25px;
                font-size: 1rem;
            }
            
            .event-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>

    <!-- Cover Section -->
    <div class="cover-screen" id="cover" style={backgroundStyle}>
        <div class="cover-content">
            <p class="cover-subtitle">Undangan Pernikahan</p>
            
            <h1 class="cover-title">{namaPertama} & {namaKedua}</h1>
            
            <p class="cover-date">
                <i class="fas fa-calendar-alt"></i> {tanggalAkad}
            </p>
            
            <!-- Countdown -->
            <div class="countdown-box" id="countdown">
                <div class="cd-item">
                    <span class="cd-num" id="d">0</span>
                    <span class="cd-label">Hari</span>
                </div>
                <div class="cd-item">
                    <span class="cd-num" id="h">0</span>
                    <span class="cd-label">Jam</span>
                </div>
                <div class="cd-item">
                    <span class="cd-num" id="m">0</span>
                    <span class="cd-label">Menit</span>
                </div>
                <div class="cd-item">
                    <span class="cd-num" id="s">0</span>
                    <span class="cd-label">Detik</span>
                </div>
            </div>
            
            <!-- Guest Info -->
            <div class="guest-box">
                <span class="guest-label">Kepada Yth. Bapak/Ibu/Saudara/i</span>
                <h3 class="guest-name" id="nama-tamu">Tamu Undangan</h3>
            </div>
            
            <!-- Open Button -->
            <button class="btn-open" id="tombol-buka">
                <i class="fas fa-envelope-open"></i> Buka Undangan
            </button>
            
            <!-- Scroll Indicator -->
            <div class="scroll-indicator">
                <i class="fas fa-chevron-down"></i> Scroll ke bawah
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="main-content">
        
        <!-- Music Control -->
        <div class="music-control" id="music-control">
            <i class="fas fa-music"></i>
        </div>
        
        <!-- Quote Section -->
        {data.quote && (
            <section class="section quote-section" id="quote">
                <div class="container">
                    <p class="quote-text">"{data.quote}"</p>
                </div>
            </section>
        )}
        
        <!-- Couple Section -->
        <section class="section" id="mempelai">
            <div class="container">
                <h2 class="section-title">Mempelai</h2>
                <p style="text-align: center; max-width: 700px; margin: 0 auto 30px;">
                    Dengan memohon rahmat dan ridho Allah SWT, kami mengundang Bapak/Ibu/Saudara/i 
                    untuk menghadiri acara pernikahan putra-putri kami:
                </p>
                
                <div class="couple-wrapper">
                    <div class="mempelai-card">
                        <div class="photo-frame">
                            <img src={first.foto} alt={first.name} class="mempelai-img" loading="lazy" />
                        </div>
                        <h3 class="mempelai-name">{first.name}</h3>
                        <div class="mempelai-nickname">{first.nickname}</div>
                        <div class="ortu-name">{first.label}<br/>{first.parents}</div>
                        
                        {first.ig && (
                            <a href={`https://instagram.com/${first.ig}`} target="_blank" class="ig-link">
                                <i class="fab fa-instagram"></i> @{first.ig}
                            </a>
                        )}
                    </div>
                    
                    <div class="divider">&</div>
                    
                    <div class="mempelai-card">
                        <div class="photo-frame">
                            <img src={second.foto} alt={second.name} class="mempelai-img" loading="lazy" />
                        </div>
                        <h3 class="mempelai-name">{second.name}</h3>
                        <div class="mempelai-nickname">{second.nickname}</div>
                        <div class="ortu-name">{second.label}<br/>{second.parents}</div>
                        
                        {second.ig && (
                            <a href={`https://instagram.com/${second.ig}`} target="_blank" class="ig-link">
                                <i class="fab fa-instagram"></i> @{second.ig}
                            </a>
                        )}
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Event Section -->
        <section class="section event-section" id="acara">
            <div class="container">
                <h2 class="section-title">Rangkaian Acara</h2>
                <div class="event-grid">
                    <!-- Akad -->
                    <div class="event-card">
                        <div class="event-icon">
                            <i class="fas fa-ring"></i>
                        </div>
                        <h3 class="event-title">Akad Nikah</h3>
                        <div class="event-date">
                            {new Date(data.akadDate).toLocaleDateString('id-ID', { 
                                weekday: 'long', 
                                day: 'numeric', 
                                month: 'long', 
                                year: 'numeric' 
                            })}
                        </div>
                        <div class="event-time">
                            <i class="far fa-clock"></i> 
                            {data.akadTimeManual ? data.akadTimeManual : new Date(data.akadDate).toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'}) + ' WIB'}
                        </div>
                        <div class="event-place">{data.akadPlace}</div>
                        <div class="event-address">{data.akadAddress}</div>
                        
                        {data.akadMaps && (
                            <a href={data.akadMaps} target="_blank" class="btn-maps">
                                <i class="fas fa-map-marker-alt"></i> Lihat Lokasi
                            </a>
                        )}
                    </div>
                    
                    <!-- Resepsi -->
                    {data.resepsiDate && (
                    <div class="event-card">
                        <div class="event-icon">
                            <i class="fas fa-glass-cheers"></i>
                        </div>
                        <h3 class="event-title">Resepsi</h3>
                        <div class="event-date">
                            {new Date(data.resepsiDate).toLocaleDateString('id-ID', { 
                                weekday: 'long', 
                                day: 'numeric', 
                                month: 'long', 
                                year: 'numeric' 
                            })}
                        </div>
                        <div class="event-time">
                            <i class="far fa-clock"></i> 
                            {data.resepsiTimeManual ? data.resepsiTimeManual : new Date(data.resepsiDate).toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'}) + ' WIB'}
                        </div>
                        <div class="event-place">{data.resepsiPlace}</div>
                        <div class="event-address">{data.resepsiAddress}</div>
                        
                        {data.resepsiMaps && (
                            <a href={data.resepsiMaps} target="_blank" class="btn-maps">
                                <i class="fas fa-map-marker-alt"></i> Lihat Lokasi
                            </a>
                        )}
                    </div>
                    )}
                </div>
            </div>
        </section>
        
        <!-- Love Story -->
        {data.loveStory && data.loveStory.length > 0 && (
            <section class="section" id="love-story">
                <div class="container">
                    <h2 class="section-title">Kisah Cinta</h2>
                    <div class="love-story-timeline">
                        {data.loveStory.map((story: any, index: number) => (
                            <div class="story-item">
                                <div class="story-year">{story.year}</div>
                                <div class="story-content">
                                    <p class="story-text">{story.story}</p>
                                    {story.image && (
                                        <img 
                                            src={urlFor(story.image).width(600).height(400).quality(85).url()} 
                                            alt="Love Story" 
                                            class="story-image" 
                                            loading="lazy"
                                        />
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </section>
        )}
        
        <!-- Gallery -->
        {data.gallery && data.gallery.length > 0 && (
            <section class="section" id="galeri">
                <div class="container">
                    <h2 class="section-title">Galeri Foto</h2>
                    <div class="gallery-grid">
                        {data.gallery.map((image: any, index: number) => (
                            <div class="gallery-item">
                                <img 
                                    src={urlFor(image).width(500).height(500).quality(85).url()} 
                                    alt="Gallery Wedding" 
                                    class="gallery-img" 
                                    loading="lazy"
                                    onclick={`openLightbox(${index})`}
                                />
                            </div>
                        ))}
                    </div>
                    
                    {data.videoLink && (
                        <div class="video-container">
                            <a href={data.videoLink} target="_blank" class="btn-video">
                                <i class="fab fa-youtube"></i> Tonton Video Pernikahan
                            </a>
                        </div>
                    )}
                </div>
            </section>
        )}
        
        <!-- Gift Section -->
        {data.bankAccounts && data.bankAccounts.length > 0 && (
            <section class="section gift-section" id="kado">
                <div class="container">
                    <h2 class="section-title">Tanda Kasih</h2>
                    <p style="text-align: center; max-width: 700px; margin: 0 auto 20px;">
                        Tanpa mengurangi rasa hormat, bagi Bapak/Ibu/Saudara/i yang ingin memberikan tanda kasih 
                        untuk mempelai, dapat melalui:
                    </p>
                    
                    <div class="bank-cards">
                        {data.bankAccounts.map((bank: any, index: number) => (
                            <div class="bank-card">
                                <div class="bank-icon">
                                    <i class="fas fa-piggy-bank"></i>
                                </div>
                                <div class="bank-name">{bank.bankName}</div>
                                <div class="account-name">a.n {bank.accountName}</div>
                                <div class="rek-number">{bank.accountNumber}</div>
                                <button class="btn-copy" onclick={`copyToClipboard('${bank.accountNumber}')`}>
                                    <i class="far fa-copy"></i> Salin No. Rekening
                                </button>
                            </div>
                        ))}
                    </div>
                    
                    {data.giftAddress && (
                        <div class="gift-address">
                            <div class="gift-address-title">
                                <i class="fas fa-gift"></i> Alamat Kirim Kado Fisik
                            </div>
                            <p style="text-align: center; line-height: 1.6;">{data.giftAddress}</p>
                        </div>
                    )}
                </div>
            </section>
        )}
        
        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <p class="footer-text">
                    Terima kasih atas doa dan restunya<br/>
                    <span style="font-family: 'Dancing Script', cursive; font-size: 1.5rem;">
                        {namaPertama} & {namaKedua}
                    </span>
                </p>
                <div class="footer-credits">
                    Made with <i class="fas fa-heart" style="color: #e8b4b8;"></i> by Gorigu
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Audio -->
    <audio id="bg-music" loop preload="auto">
        <source src={`/music/${data.music || 'lagu1.mp3'}`} type="audio/mpeg">
    </audio>
    
    <script is:inline define:vars={{ 
        targetDate: data.akadDate,
        musicFile: data.music || 'lagu1.mp3'
    }}>
        // 1. Ambil Parameter Nama Tamu dari URL
        const params = new URLSearchParams(window.location.search);
        const tamu = params.get('tamu') || params.get('to') || params.get('nama');
        if(tamu) {
            document.getElementById('nama-tamu').innerText = decodeURIComponent(tamu);
        }
        
        // 2. Logic Tombol Buka Undangan
        const tombolBuka = document.getElementById('tombol-buka');
        const coverScreen = document.getElementById('cover');
        const mainContent = document.getElementById('main-content');
        const audio = document.getElementById('bg-music');
        const musicControl = document.getElementById('music-control');
        let isPlaying = false;
        
        // Fungsi untuk membuka undangan
        function bukaUndangan() {
            // Hilangkan Cover, Munculkan Isi
            coverScreen.style.display = 'none';
            mainContent.style.display = 'block';
            document.body.style.overflow = 'auto';
            document.documentElement.style.scrollBehavior = 'smooth';
            
            // Scroll ke atas
            window.scrollTo(0, 0);
            
            // Play Music
            if(audio) {
                audio.volume = 0.5;
                audio.play()
                .then(() => {
                    console.log("Audio playing");
                    isPlaying = true;
                    if(musicControl) {
                        musicControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                    }
                })
                .catch(e => {
                    console.log("Gagal memutar audio:", e);
                    // Beberapa browser membutuhkan interaksi user terlebih dahulu
                });
            }
        }
        
        if(tombolBuka) {
            tombolBuka.addEventListener('click', bukaUndangan);
        }
        
        // 3. Logic Countdown
        const countDownDate = new Date(targetDate).getTime();
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = countDownDate - now;
            
            if (distance >= 0) {
                document.getElementById("d").innerText = Math.floor(distance / (1000 * 60 * 60 * 24));
                document.getElementById("h").innerText = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                document.getElementById("m").innerText = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById("s").innerText = Math.floor((distance % (1000 * 60)) / 1000);
            } else {
                // Jika acara sudah lewat
                document.getElementById("d").innerText = "0";
                document.getElementById("h").innerText = "0";
                document.getElementById("m").innerText = "0";
                document.getElementById("s").innerText = "0";
            }
        }
        
        // Update countdown setiap detik
        updateCountdown();
        setInterval(updateCountdown, 1000);
        
        // 4. Music Control
        if(musicControl && audio) {
            musicControl.addEventListener('click', function() {
                if(isPlaying) {
                    audio.pause();
                    musicControl.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    isPlaying = false;
                } else {
                    audio.play()
                    .then(() => {
                        musicControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                        isPlaying = true;
                    })
                    .catch(e => {
                        console.log("Gagal memutar audio:", e);
                        // Tampilkan alert untuk interaksi pertama
                        if(audio.paused) {
                            alert("Silakan klik tombol 'Buka Undangan' terlebih dahulu untuk memutar musik.");
                        }
                    });
                }
            });
        }
        
        // 5. Fungsi Copy to Clipboard
        window.copyToClipboard = function(text) {
            navigator.clipboard.writeText(text)
                .then(() => {
                    // Tampilkan notifikasi sederhana
                    const originalText = event.target.innerHTML;
                    event.target.innerHTML = '<i class="fas fa-check"></i> Tersalin!';
                    event.target.style.background = '#28a745';
                    
                    setTimeout(() => {
                        event.target.innerHTML = originalText;
                        event.target.style.background = '';
                    }, 2000);
                })
                .catch(err => {
                    console.error('Gagal menyalin: ', err);
                    alert('Gagal menyalin teks. Silakan salin manual: ' + text);
                });
        };
        
        // 6. Fungsi Lightbox untuk Gallery (sederhana)
        window.openLightbox = function(index) {
            // Implementasi lightbox sederhana
            const images = document.querySelectorAll('.gallery-img');
            if(images[index]) {
                const imgSrc = images[index].src;
                const lightbox = document.createElement('div');
                lightbox.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.9);
                    z-index: 9999;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    cursor: pointer;
                `;
                
                const img = document.createElement('img');
                img.src = imgSrc;
                img.style.cssText = `
                    max-width: 90%;
                    max-height: 90%;
                    object-fit: contain;
                    border-radius: 10px;
                `;
                
                lightbox.appendChild(img);
                lightbox.onclick = function() {
                    document.body.removeChild(lightbox);
                };
                
                document.body.appendChild(lightbox);
            }
        };
        
        // 7. Auto-play music setelah interaksi pertama (untuk beberapa browser)
        document.addEventListener('click', function initAudio() {
            if(audio && audio.paused) {
                // Coba play audio dengan volume rendah
                audio.volume = 0.3;
                audio.play().catch(e => console.log("Audio autoplay prevented"));
            }
            // Hapus event listener setelah pertama kali diklik
            document.removeEventListener('click', initAudio);
        });
        
        // 8. Touch event untuk mobile
        let startY;
        document.addEventListener('touchstart', function(e) {
            startY = e.touches[0].clientY;
        });
        
        document.addEventListener('touchmove', function(e) {
            if(!startY) return;
            
            const currentY = e.touches[0].clientY;
            const diff = startY - currentY;
            
            // Jika scroll ke atas cukup jauh, buka undangan
            if(diff > 100 && coverScreen.style.display !== 'none') {
                bukaUndangan();
            }
        });
    </script>
</body>
</html>