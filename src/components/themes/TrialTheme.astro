---
import { urlFor } from "../../utils/image";

const { data } = Astro.props;

// Logic Data
const isPriaFirst = data.nameOrder !== 'wanitaFirst';
const namaPertama = isPriaFirst ? data.priaNickname : data.wanitaNickname;
const namaKedua = isPriaFirst ? data.wanitaNickname : data.priaNickname;
const tanggalAkad = new Date(data.akadDate).toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

// Ambil URL Gambar
const coverUrl = data.coverImage 
  ? urlFor(data.coverImage).width(800).height(1200).url() 
  : 'https://placehold.co/800x1200/333/fff?text=Upload+Cover';

// Kita siapkan string CSS untuk background di sini biar HTML bersih
// Perhatikan: Kita pakai 'linear-gradient' ditumpuk dengan 'url' gambar
const backgroundStyle = `background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('${coverUrl}');`;
---

<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding of {namaPertama} & {namaKedua}</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,400&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
    
    <style>
        body { margin: 0; font-family: 'Poppins', sans-serif; overflow: hidden; background-color: #333; /* Default gelap */ }
        
        .cover-screen {
            height: 100vh;
            width: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white;
            
            /* Setting agar gambar pas di tengah */
            background-size: cover;
            background-position: center top;
        }

        h1 { font-family: 'Playfair Display', serif; font-size: 3.5rem; margin: 0; line-height: 1.2; text-shadow: 2px 2px 10px rgba(0,0,0,0.5); }
        .guest-box { margin: 40px 40px 0 40px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(5px); padding: 15px 30px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3);}
        .btn-open { margin-top: 30px; background: white; color: #333; border: none; padding: 12px 30px; border-radius: 50px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        
        /* Countdown */
        .countdown-box { display: flex; gap: 15px; margin-top: 30px; }
        .cd-item { text-align: center; }
        .cd-num { font-size: 1.5rem; font-weight: bold; }
        .cd-label { font-size: 0.6rem; text-transform: uppercase; }

        #main-content { display: none; background: white; color: black; padding: 50px 20px; text-align: center; min-height: 100vh;}
    </style>
</head>
<body>

    <div class="cover-screen" id="cover" style={backgroundStyle}>
        
        <p style="letter-spacing: 3px; font-size: 0.9rem; margin-bottom: 10px; opacity: 0.9;">THE WEDDING OF</p>
        
        <h1>{namaPertama} <br> <span style="font-size: 2rem; font-style: italic;">&</span> <br> {namaKedua}</h1>
        
        <p style="margin-top: 10px; font-weight: 300;">{tanggalAkad}</p>

        <div class="countdown-box" id="countdown">
            <div class="cd-item"><span class="cd-num" id="d">0</span><span class="cd-label">Hari</span></div>
            <div class="cd-item"><span class="cd-num" id="h">0</span><span class="cd-label">Jam</span></div>
            <div class="cd-item"><span class="cd-num" id="m">0</span><span class="cd-label">Menit</span></div>
            <div class="cd-item"><span class="cd-num" id="s">0</span><span class="cd-label">Detik</span></div>
        </div>

        <div class="guest-box">
            <small style="opacity: 0.8;">Kepada Yth. Bapak/Ibu/Saudara/i:</small>
            <h3 id="nama-tamu" style="margin: 5px 0 0 0;">Tamu Undangan</h3>
        </div>

        <button class="btn-open" onclick="bukaUndangan()">
            ðŸ’Œ Buka Undangan
        </button>
    </div>

    <div id="main-content">
        <h2>Terima Kasih</h2>
        <p>Anda telah membuka undangan ini.</p>
    </div>

    <audio id="bg-music" loop>
        <source src={`/music/${data.music || 'default.mp3'}`} type="audio/mpeg">
    </audio>

    <script is:inline define:vars={{ targetDate: data.akadDate }}>
        // Logic Countdown & Nama Tamu (Sama seperti sebelumnya)
        const params = new URLSearchParams(window.location.search);
        const tamu = params.get('tamu');
        if(tamu) document.getElementById('nama-tamu').innerText = tamu;

        function bukaUndangan() {
            document.getElementById('cover').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.body.style.overflow = 'auto';
            document.getElementById('bg-music').play().catch(e => console.log(e));
        }

        const countDownDate = new Date(targetDate).getTime();
        setInterval(function() {
            const now = new Date().getTime();
            const distance = countDownDate - now;
            if (distance >= 0) {
                document.getElementById("d").innerText = Math.floor(distance / (1000 * 60 * 60 * 24));
                document.getElementById("h").innerText = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                document.getElementById("m").innerText = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById("s").innerText = Math.floor((distance % (1000 * 60)) / 1000);
            }
        }, 1000);
    </script>
</body>
</html>