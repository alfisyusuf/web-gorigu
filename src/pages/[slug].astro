---
import { sanityClient } from "sanity:client";
import SimpleTheme from '../components/themes/SimpleTheme.astro';
import RusticTheme from '../components/themes/RusticTheme.astro';

// 1. Ambil slug dari URL
const { slug } = Astro.params;

if (!slug) return Astro.redirect("/404");

// 2. Query Data Lengkap
// Kita gunakan tanda *...* untuk mengambil semua field dasar,
// lalu kita spesifikkan field yang berupa gambar/array agar tidak tertinggal.
const data = await sanityClient.fetch(
  `*[_type == "wedding" && slug.current == $slug][0]{
    ...,
    "theme": theme,
    coverImage,
    priaFoto,
    wanitaFoto,
    gallery,
    loveStory,
    bankAccounts
  }`,
  { slug }
);

// Jika data tidak ditemukan
if (!data) return new Response(null, { status: 404, statusText: 'Not Found' });

// 3. Logika Pemilihan Tema
let SelectedTheme;

if (data.theme === 'rustic') {
  SelectedTheme = RusticTheme;
} else if (data.theme === 'jawa') {
  // Sementara kita arahkan Jawa ke Rustic dulu (karena struktur mirip) 
  // atau Anda bisa buat JawaTheme.astro nanti
  SelectedTheme = RusticTheme; 
} else {
  // Default: Simple / Minimalis / Floral
  SelectedTheme = SimpleTheme;
}
---

<SelectedTheme data={data} />